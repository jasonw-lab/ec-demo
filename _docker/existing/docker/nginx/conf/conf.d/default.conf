server {
    listen       80;
    listen  [::]:80;
    server_name  localhost;

    #access_log  /var/log/nginx/host.access.log  main;

    # Default route - can be a landing page or redirect
    location = / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }

    # Retail app route
    location /retail {
        alias   /usr/share/nginx/html/retail;
        index  index.html index.htm;
        try_files $uri $uri/ /retail/index.html;
    }

    # BookingHotel app route
    location /booking {
        alias   /usr/share/nginx/html/booking;
        index  index.html index.htm;
        try_files $uri $uri/ /booking/index.html;
    }

    # PhotoGallary app route
    location /gallery {
        alias   /usr/share/nginx/html/gallery;
        index  index.html index.htm;
        try_files $uri $uri/ /gallery/index.html;
    }

    # Weather app route
    location /weather {
        alias   /usr/share/nginx/html/weather;
        index  index.html index.htm;
        try_files $uri $uri/ /weather/index.html;
    }

    # MealPlanner app route
    location /meal {
        alias   /usr/share/nginx/html/meal;
        index  index.html index.htm;
        try_files $uri $uri/ /meal/index.html;
    }

    # PhotoGallary app route
    location /photo-gallary {
        alias   /usr/share/nginx/html/photo-gallary;
        index  index.html index.htm;
        try_files $uri $uri/ /photo-gallary/index.html;
    }

   # PhotoGallary app route
    location /vuepress {
        alias   /usr/share/nginx/html/vuepress;
        index  index.html index.htm;
        try_files $uri $uri/ /vuepress/index.html;
    }

    # API proxy for retail-api backend
    location /prod-api/ {

#         # CORSヘッダーを常に追加
#         add_header Access-Control-Allow-Origin * always;
#         add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS, PUT, DELETE' always;
#         add_header Access-Control-Allow-Headers 'Origin, Authorization, Content-Type, Accept, Sec-Fetch-Mode, Sec-Fetch-Site, Sec-Fetch-Dest' always;
#
#         # OPTIONSプリフライト対応
#         if ($request_method = OPTIONS ) {
#             add_header Access-Control-Max-Age 1728000;
#             add_header Content-Type 'text/plain charset=UTF-8';
#             add_header Content-Length 0;
#             return 204;
#         }

        proxy_pass http://retail-api:8989/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

#         proxy_set_header Sec-Fetch-Mode $http_sec_fetch_mode;
#         proxy_set_header Sec-Fetch-Site $http_sec_fetch_site;
#         proxy_set_header Sec-Fetch-Dest $http_sec_fetch_dest;
    }

    # ec-demo configuration
    # 分離可能: この行をコメントアウトまたは削除することでec-demo設定を無効化できます
    include ec-demo.conf;

    # error page handling
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}
