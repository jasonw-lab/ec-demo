version: '3.8'

services:
  ec-demo-elasticsearch:
    # NOTE: Elasticsearch 9.x の実在するタグに合わせて調整してください（例: 9.0.0）。
    image: ${ELASTICSEARCH_IMAGE:-docker.elastic.co/elasticsearch/elasticsearch:9.0.0}
    platform: linux/arm64
    container_name: ec-demo-elasticsearch9
    restart: unless-stopped
    environment:
      - TZ=Asia/Tokyo
      - discovery.type=single-node
      - xpack.security.enabled=false
      - xpack.security.enrollment.enabled=false
      - ES_JAVA_OPTS=-Xms${ES_HEAP:-1g} -Xmx${ES_HEAP:-1g}
      - http.port=9200
      - transport.port=9300
    ports:
      - "${ES_HTTP_PORT:-9200}:9200"
      - "${ES_TRANSPORT_PORT:-9300}:9300"
    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 65536
        hard: 65536
    volumes:
      - ${basepath:-/mydata/ec-demo}/elasticsearch/data:/usr/share/elasticsearch/data
    healthcheck:
      test: ["CMD-SHELL", "bash -c '</dev/tcp/127.0.0.1/9200'"]
      interval: 10s
      timeout: 3s
      retries: 30
    networks:
      - seata-net

networks:
  seata-net:
    external: true
    name: seata-net
